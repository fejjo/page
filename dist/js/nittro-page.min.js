_context.invoke("Nittro.Ajax",function(undefined){var FormData=_context.extend(function(){this._dataStorage=[],this._upload=!1},{append:function(name,value){if(value===undefined||null===value)return this;if(this._isFile(value))this._upload=!0;else{if("object"==typeof value&&"valueOf"in value&&/string|number|boolean/.test(typeof value.valueOf())&&!arguments[2])return this.append(name,value.valueOf(),!0);if(!/string|number|boolean/.test(typeof value))throw new Error("Only scalar values and File/Blob objects can be appended to FormData, "+typeof value+" given")}return this._dataStorage.push({name:name,value:value}),this},isUpload:function(){return this._upload},_isFile:function(value){return window.File!==undefined&&value instanceof window.File||window.Blob!==undefined&&value instanceof window.Blob},mergeData:function(data){for(var i=0;i<data.length;i++)this.append(data[i].name,data[i].value);return this},exportData:function(forcePlain){if(!forcePlain&&this.isUpload()&&window.FormData!==undefined){var i,fd=new window.FormData;for(i=0;i<this._dataStorage.length;i++)fd.append(this._dataStorage[i].name,this._dataStorage[i].value);return fd}return this._dataStorage.filter(function(e){return!this._isFile(e.value)},this)}});_context.register(FormData,"FormData")}),_context.invoke("Nittro.Ajax",function(Url,FormData,undefined){var Request=_context.extend("Nittro.Object",function(url,method,data){this._={url:Url.from(url),method:(method||"GET").toUpperCase(),data:data||{},headers:{},normalized:!1,aborted:!1}},{getUrl:function(){return this._normalize(),this._.url},getMethod:function(){return this._.method},isGet:function(){return"GET"===this._.method},isPost:function(){return"POST"===this._.method},isMethod:function(method){return method.toUpperCase()===this._.method},getData:function(){return this._normalize(),this._.data},getHeaders:function(){return this._.headers},setUrl:function(url){return this._updating("url"),this._.url=Url.from(url),this},setMethod:function(method){return this._updating("method"),this._.method=method.toLowerCase(),this},setData:function(k,v){if(this._updating("data"),null===k)this._.data={};else if(v===undefined&&"object"==typeof k)for(v in k)k.hasOwnProperty(v)&&(this._.data[v]=k[v]);else this._.data[k]=v;return this},setHeader:function(header,value){return this._updating("headers"),this._.headers[header]=value,this},setHeaders:function(headers){this._updating("headers");for(var header in headers)headers.hasOwnProperty(header)&&(this._.headers[header]=headers[header]);return this},abort:function(){return this._.aborted||(this._.aborted=!0,this.trigger("abort")),this},isAborted:function(){return this._.aborted},_normalize:function(){!this._.normalized&&this.isFrozen()&&(this._.normalized=!0,("GET"===this._.method||"HEAD"===this._.method)&&(this._.url.addParams(this._.data instanceof FormData?this._.data.exportData(!0):this._.data),this._.data={}))}});_context.mixin(Request,"Nittro.Freezable"),_context.register(Request,"Request")},{Url:"Utils.Url"}),_context.invoke("Nittro.Ajax",function(){var Response=_context.extend(function(status,payload,headers){this._={status:status,payload:payload,headers:headers}},{getStatus:function(){return this._.status},getPayload:function(){return this._.payload},getHeader:function(name){return this._.headers[name.toLowerCase()]},getAllHeaders:function(){return this._.headers}});_context.register(Response,"Response")}),_context.invoke("Nittro.Ajax",function(Request){var Service=_context.extend("Nittro.Object",function(){Service.Super.call(this),this._.transports=[]},{addTransport:function(transport){return this._.transports.push(transport),this},get:function(url,data){return this.dispatch(this.createRequest(url,"get",data))},post:function(url,data){return this.dispatch(this.createRequest(url,"post",data))},createRequest:function(url,method,data){var request=new Request(url,method,data);return this.trigger("request-created",{request:request}),request},dispatch:function(request){request.freeze();for(var i=0;i<this._.transports.length;i++)try{return this._.transports[i].dispatch(request)}catch(e){console.log(e)}throw new Error("No transport is able to dispatch this request")}});_context.register(Service,"Service")}),_context.invoke("Nittro.Ajax.Transport",function(Response,FormData,Url){var Native=_context.extend(function(){},{STATIC:{createXhr:function(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return new ActiveXObject("Microsoft.XMLHTTP")}}},dispatch:function(request){var xhr=Native.createXhr(),adv=this.checkSupport(xhr),self=this,abort=function(){xhr.abort()},cleanup=function(){request.off("abort",abort)};return request.on("abort",abort),new Promise(function(fulfill,reject){request.isAborted()&&(cleanup(),reject(self._createError(xhr,{type:"abort"}))),self._bindEvents(request,xhr,adv,cleanup,fulfill,reject),xhr.open(request.getMethod(),request.getUrl().toAbsolute(),!0);var data=self._formatData(request,xhr);self._addHeaders(request,xhr),xhr.send(data)})},checkSupport:function(xhr){var adv;if(!((adv="addEventListener"in xhr)||"onreadystatechange"in xhr))throw new Error("Unsupported XHR implementation");return adv},_bindEvents:function(request,xhr,adv,cleanup,fulfill,reject){var self=this,onLoad=function(evt){if(cleanup(),200===xhr.status){var response=self._createResponse(xhr);request.trigger("success",response),fulfill(response)}else{var err=self._createError(xhr,evt);request.trigger("error",err),reject(err)}},onError=function(evt){cleanup();var err=self._createError(xhr,evt);request.trigger("error",err),reject(err)},onProgress=function(evt){request.trigger("progress",{lengthComputable:evt.lengthComputable,loaded:evt.loaded,total:evt.total})};adv?(xhr.addEventListener("load",onLoad,!1),xhr.addEventListener("error",onError,!1),xhr.addEventListener("abort",onError,!1),"upload"in xhr&&xhr.upload.addEventListener("progress",onProgress,!1)):(xhr.onreadystatechange=function(){4===xhr.readyState&&(200===xhr.status?onLoad():onError())},"ontimeout"in xhr&&(xhr.ontimeout=onError),"onerror"in xhr&&(xhr.onerror=onError),"onload"in xhr&&(xhr.onload=onLoad))},_addHeaders:function(request,xhr){var h,headers=request.getHeaders();for(h in headers)headers.hasOwnProperty(h)&&xhr.setRequestHeader(h,headers[h]);headers.hasOwnProperty("X-Requested-With")||xhr.setRequestHeader("X-Requested-With","XMLHttpRequest")},_formatData:function(request,xhr){var data=request.getData();return data instanceof FormData?(data=data.exportData(request.isGet()||request.isMethod("HEAD")),data instanceof window.FormData||(data=Url.buildQuery(data,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"))):(data=Url.buildQuery(data),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),data},_createResponse:function(xhr){var payload,headers={};return(xhr.getAllResponseHeaders()||"").trim().split(/\r\n/g).forEach(function(header){header&&!header.match(/^\s+$/)&&(header=header.match(/^\s*([^:]+):\s*(.+)\s*$/),headers[header[1].toLowerCase()]=header[2])}),payload=headers["content-type"]&&"application/json"===headers["content-type"].split(/;/)[0]?JSON.parse(xhr.responseText||"{}"):xhr.responseText,new Response(xhr.status,payload,headers)},_createError:function(xhr,evt){var response=null;return 4===xhr.readyState&&0!==xhr.status&&(response=this._createResponse(xhr)),evt&&"abort"===evt.type?{type:"abort",status:null,response:response}:0===xhr.status?{type:"connection",status:null,response:response}:200!==xhr.status?{type:"response",status:xhr.status,response:response}:{type:"unknown",status:xhr.status,response:response}}});_context.register(Native,"Native")},{Url:"Utils.Url",Response:"Nittro.Ajax.Response",FormData:"Nittro.Ajax.FormData"}),_context.invoke("Nittro.Page",function(DOM,undefined){var Snippet=_context.extend(function(id,state){this._={id:id,container:!1,state:"number"==typeof state?state:Snippet.INACTIVE,data:{},handlers:[[],[],[],[]]}},{STATIC:{INACTIVE:-1,PREPARE_SETUP:0,RUN_SETUP:1,PREPARE_TEARDOWN:2,RUN_TEARDOWN:3},getId:function(){return this._.id},setup:function(prepare,run){return prepare&&!run&&(run=prepare,prepare=null),prepare&&(this._.state===Snippet.PREPARE_SETUP?prepare(this.getElement()):this._.handlers[Snippet.PREPARE_SETUP].push(prepare)),run&&(this._.state===Snippet.RUN_SETUP?run(this.getElement()):this._.handlers[Snippet.RUN_SETUP].push(run)),this},teardown:function(prepare,run){return prepare&&!run&&(run=prepare,prepare=null),prepare&&(this._.state===Snippet.PREPARE_TEARDOWN?prepare(this.getElement()):this._.handlers[Snippet.PREPARE_TEARDOWN].push(prepare)),run&&(this._.state===Snippet.RUN_TEARDOWN?run(this.getElement()):this._.handlers[Snippet.RUN_TEARDOWN].push(run)),this},setState:function(state){if(state===Snippet.INACTIVE)this._.state=state,this._.handlers.forEach(function(queue){queue.splice(0,queue.length)});else if(state-1===this._.state){this._.state=state;var elm=this.getElement();this._.handlers[this._.state].forEach(function(handler){handler(elm)}),this._.handlers[this._.state].splice(0,this._.handlers[this._.state].length)}return this},getState:function(){return this._.state},getData:function(key,def){return key in this._.data?this._.data[key]:def===undefined?null:def},setData:function(key,value){return this._.data[key]=value,this},setContainer:function(){return this._.container=!0,this},isContainer:function(){return this._.container},getElement:function(){return DOM.getById(this._.id)}});_context.register(Snippet,"Snippet")},{DOM:"Utils.DOM"}),_context.invoke("Nittro.Page",function(Snippet,DOM){var SnippetHelpers={_getTransitionTargets:function(elem){var sel=DOM.getData(elem,"transition")||this._.options.defaultTransition;return sel?DOM.find(sel):[]},_getRemoveTargets:function(elem){var sel=DOM.getData(elem,"dynamic-remove");return sel?DOM.find(sel):[]},_getDynamicContainerCache:function(){return null===this._.containerCache&&(this._.containerCache=DOM.getByClassName("snippet-container").map(function(elem){return elem.id})),this._.containerCache},_clearDynamicContainerCache:function(){this._.containerCache=null},_getDynamicContainer:function(id){var i,n,container,data,cache=this._getDynamicContainerCache();for(i=0,n=cache.length;n>i;i++)if(container=this.getSnippet(cache[i]),data=container.isContainer()?container.getData("_container"):this._prepareDynamicContainer(container),data.mask.test(id))return data;throw new Error("Dynamic snippet #"+id+" has no container")},_applySnippets:function(snippets,removeElms){var setup={},teardown={},dynamic=[],containers={};return this._clearDynamicContainerCache(),this._prepareStaticSnippets(snippets,setup,teardown,dynamic,removeElms),this._prepareDynamicSnippets(dynamic,snippets,containers),this._prepareRemoveTargets(removeElms,teardown),this._teardown(teardown),this._applyRemove(removeElms),this._applyContainers(containers,teardown),this._applySetup(setup,snippets),this._setup(),dynamic.map(function(snippet){return snippet.elem?(DOM.addClass(snippet.elem,"dynamic-update"),snippet.elem):(DOM.addClass(snippet.content,"dynamic-add"),snippet.content)})},_prepareDynamicContainer:function(snippet){var elem=snippet.getElement(),data={id:snippet.getId(),mask:new RegExp("^"+DOM.getData(elem,"dynamic-mask")+"$"),element:DOM.getData(elem,"dynamic-element")||"div",sort:DOM.getData(elem,"dynamic-sort")||"append",sortCache:DOM.getData(elem,"dynamic-sort-cache")===!1?!1:null};return snippet.setContainer(),snippet.setData("_container",data),data},_prepareRemoveTargets:function(removeElms,teardown){for(var i=0;i<removeElms.length;i++)this._prepareRemoveTarget(removeElms[i],teardown)},_prepareRemoveTarget:function(elem,teardown){this._cleanupChildSnippets(elem,teardown),this._cleanupForms(elem),this.isSnippet(elem)&&(teardown[elem.id]=!0)},_prepareStaticSnippets:function(snippets,setup,teardown,dynamic,removeElms){for(var id in snippets)snippets.hasOwnProperty(id)&&this._prepareStaticSnippet(id,setup,teardown,dynamic,removeElms)},_prepareStaticSnippet:function(id,setup,teardown,dynamic,removeElms){this._.snippets[id]&&this._.snippets[id].getState()===Snippet.RUN_SETUP&&(teardown[id]=!1);var dyn,snippet=DOM.getById(id);snippet?(dyn=DOM.hasClass(snippet.parentNode,"snippet-container"),removeElms.length&&-1!==removeElms.indexOf(snippet)?dynamic.push({id:id}):(this._cleanupChildSnippets(snippet,teardown),this._cleanupForms(snippet),dyn?dynamic.push({id:id,elem:snippet}):setup[id]=snippet)):dynamic.push({id:id})},_prepareDynamicSnippets:function(dynamic,snippets,containers){for(var i=0;i<dynamic.length;i++)this._prepareDynamicSnippet(dynamic[i],snippets[dynamic[i].id],containers)},_prepareDynamicSnippet:function(snippet,content,containers){var container=this._getDynamicContainer(snippet.id);snippet.content=this._createDynamic(container.element,snippet.id,content),containers[container.id]||(containers[container.id]=[]),containers[container.id].push(snippet)},_createDynamic:function(elem,id,html){return elem=elem.split(/\./g),elem[0]=DOM.create(elem,{id:id}),elem.length>1&&DOM.addClass.apply(null,elem),elem=elem[0],DOM.html(elem,html),elem},_applyRemove:function(removeElms){removeElms.forEach(function(elem){elem.parentNode.removeChild(elem)})},_applySetup:function(snippets,data){for(var id in snippets)snippets.hasOwnProperty(id)&&DOM.html(snippets[id],data[id])},_applyContainers:function(containers,teardown){for(var id in containers)containers.hasOwnProperty(id)&&this._applyDynamic(this.getSnippet(id),containers[id],teardown)},_applyDynamic:function(container,snippets,teardown){var containerData=container.getData("_container");"append"===containerData.sort?this._appendDynamic(container.getElement(),snippets):"prepend"===containerData.sort?this._prependDynamic(container.getElement(),snippets):this._sortDynamic(containerData,container.getElement(),snippets,teardown)},_appendDynamic:function(elem,snippets){snippets.forEach(function(snippet){snippet.elem?DOM.html(snippet.elem,snippet.content.innerHTML):elem.appendChild(snippet.content)})},_prependDynamic:function(elem,snippets){var first=elem.firstChild;snippets.forEach(function(snippet){snippet.elem?DOM.html(snippet.elem,snippet.content.innerHTML):elem.insertBefore(snippet.content,first)})},_sortDynamic:function(container,elem,snippets,teardown){var sortData=this._getSortData(container,elem,teardown);this._mergeSortData(sortData,snippets.map(function(snippet){return snippet.content}));var sorted=this._applySort(sortData);snippets=this._getSnippetMap(snippets),this._insertSorted(elem,sorted,snippets)},_insertSorted:function(container,sorted,snippets){var tmp,i=0,n=sorted.length;for(tmp=container.firstElementChild;n>i&&sorted[i]in snippets&&!snippets[sorted[i]].elem;)container.insertBefore(snippets[sorted[i]].content,tmp),i++;for(;n>i&&sorted[n-1]in snippets&&!snippets[sorted[n-1]].elem;)n--;for(;n>i;i++)if(sorted[i]in snippets)if(snippets[sorted[i]].elem)for(snippets[sorted[i]].elem.innerHTML="",snippets[sorted[i]].elem.previousElementSibling!==(i>0?DOM.getById(sorted[i-1]):null)&&container.insertBefore(snippets[sorted[i]].elem,i>0?DOM.getById(sorted[i-1]).nextElementSibling:container.firstElementChild);tmp=snippets[sorted[i]].content.firstChild;)snippets[sorted[i]].elem.appendChild(tmp);else container.insertBefore(snippets[sorted[i]].content,DOM.getById(sorted[i-1]).nextElementSibling);for(;n<sorted.length;)container.appendChild(snippets[sorted[n]].content),n++},_getSnippetMap:function(snippets){var map={};return snippets.forEach(function(snippet){map[snippet.id]=snippet}),map},_applySort:function(sortData){var id,sorted=[];for(id in sortData.snippets)sorted.push({id:id,values:sortData.snippets[id]});return sorted.sort(this._compareDynamic.bind(this,sortData.descriptor)),sorted.map(function(snippet){return snippet.id})},_compareDynamic:function(descriptor,a,b){var i,n,v;for(i=0,n=descriptor.length;n>i;i++)if(v=a.values[i]<b.values[i]?-1:a.values[i]>b.values[i]?1:0,0!==v)return v*(descriptor[i].asc?1:-1);return 0},_getSortData:function(container,elem,teardown){var sortData=container.sortCache;if(sortData)for(var id in sortData.snippets)id in teardown&&teardown[id]&&delete sortData.snippets[id];else sortData=this._buildSortData(container,elem,teardown),container.sortCache!==!1&&(container.sortCache=sortData);return sortData},_buildSortData:function(container,elem,teardown){var sortData={descriptor:container.sort.trim().split(/\s*,\s*/g).map(this._parseDescriptor.bind(this,container.id)),snippets:{}};return this._mergeSortData(sortData,DOM.getChildren(elem),teardown),sortData},_mergeSortData:function(sortData,snippets,teardown){snippets.forEach(function(snippet){var id=snippet.id;teardown&&id in teardown&&teardown[id]||(sortData.snippets[id]=this._extractSortData(snippet,sortData.descriptor))}.bind(this))},_extractSortData:function(snippet,descriptor){return descriptor.map(function(field){return field.extractor(snippet)})},_parseDescriptor:function(id,descriptor){var sel,attr,prop,asc,m=descriptor.match(/^(.+?)(?:\[(.+?)\])?(?:\((.+?)\))?(?:\s+(.+?))?$/);if(!m)throw new Error("Invalid sort descriptor: "+descriptor);if(sel=m[1],attr=m[2],prop=m[3],asc=m[4],sel.match(/^[^.]|[\s#\[>+:]/))throw new TypeError("Invalid selector for sorted insert mode in container #"+id);return sel=sel.substr(1),asc=asc?/^[1tay]/i.test(asc):!0,attr?{extractor:this._getAttrExtractor(sel,attr),asc:asc}:prop?{extractor:this._getDataExtractor(sel,prop),asc:asc}:{extractor:this._getTextExtractor(sel),asc:asc}},_getAttrExtractor:function(sel,attr){return function(elem){return elem=elem.getElementsByClassName(sel),elem.length?elem[0].getAttribute(attr)||null:null}},_getDataExtractor:function(sel,prop){return function(elem){return elem=elem.getElementsByClassName(sel),elem.length?DOM.getData(elem[0],prop):null}},_getTextExtractor:function(sel){return function(elem){return elem=elem.getElementsByClassName(sel),elem.length?elem[0].textContent:null}},_teardown:function(snippets){this._setSnippetsState(snippets,Snippet.PREPARE_TEARDOWN),this._setSnippetsState(snippets,Snippet.RUN_TEARDOWN),this._setSnippetsState(snippets,Snippet.INACTIVE),this.trigger("teardown");for(var id in snippets)snippets.hasOwnProperty(id)&&snippets[id]&&delete this._.snippets[id]},_setup:function(){this.trigger("setup"),this._setSnippetsState(this._.snippets,Snippet.PREPARE_SETUP),this._setSnippetsState(this._.snippets,Snippet.RUN_SETUP)},_setSnippetsState:function(snippets,state){this._.currentPhase=state;for(var id in snippets)snippets.hasOwnProperty(id)&&this.getSnippet(id).setState(state)},_cleanupChildSnippets:function(elem,teardown){for(var i in this._.snippets)this._.snippets.hasOwnProperty(i)&&this._.snippets[i].getState()===Snippet.RUN_SETUP&&this._.snippets[i].getElement()!==elem&&DOM.contains(elem,this._.snippets[i].getElement())&&(teardown[i]=!0)},_cleanupForms:function(snippet){if(this._.formLocator)if("form"===snippet.tagName.toLowerCase())this._.formLocator.removeForm(snippet);else{var i,forms=snippet.getElementsByTagName("form");for(i=0;i<forms.length;i++)this._.formLocator.removeForm(forms.item(i))}}};_context.register(SnippetHelpers,"SnippetHelpers")},{DOM:"Utils.DOM"}),_context.invoke("Nittro.Page",function(DOM,Arrays){var Transitions=_context.extend(function(duration){this._={duration:duration||!1,ready:!0,queue:[],support:!1,property:null};try{var s=DOM.create("span").style;this._.support=["transition","WebkitTransition","MozTransition","msTransition","OTransition"].some(function(prop){return prop in s?(this._.property=prop,!0):void 0}.bind(this)),s=null}catch(e){}},{transitionOut:function(elements){return this._begin(elements,"transition-out")},transitionIn:function(elements){return this._begin(elements,"transition-in")},_begin:function(elements,className){return this._.support&&this._.duration&&elements.length?this._resolve(elements,className):Promise.resolve(elements)},_resolve:function(elements,className){if(!this._.ready)return new Promise(function(resolve){this._.queue.push([elements,className,resolve])}.bind(this));if(this._.ready=!1,"transition-in"===className){window.pageXOffset}DOM.addClass(elements,"transition-active "+className),DOM.removeClass(elements,"transition-middle");var duration=this._getDuration(elements),promise=new Promise(function(resolve){window.setTimeout(function(){DOM.removeClass(elements,"transition-active "+className),"transition-out"===className&&DOM.addClass(elements,"transition-middle"),this._.ready=!0,resolve(elements)}.bind(this),duration)}.bind(this));return promise.then(function(){if(this._.queue.length){var q=this._.queue.shift();this._resolve(q[0],q[1]).then(function(){q[2](q[0])})}}.bind(this)),promise},_getDuration:function(elements){if(!window.getComputedStyle)return this._.duration;var durations=[],prop=this._.property+"Duration";return elements.forEach(function(elem){var duration=window.getComputedStyle(elem)[prop];duration&&(duration=(duration+"").trim().split(/\s*,\s*/g).map(function(v){return v=v.match(/^((?:\d*\.)?\d+)(m?s)$/),v?parseFloat(v[1])*("ms"===v[2]?1:1e3):0}),durations.push.apply(durations,duration.filter(function(v){return v>0})))}),durations.length?Math.max.apply(null,durations):this._.duration}});_context.register(Transitions,"Transitions")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays"}),_context.invoke("Nittro.Page",function(DOM,Arrays,Url,SnippetHelpers,Snippet){var Service=_context.extend("Nittro.Object",function(ajax,transitions,flashMessages,options){Service.Super.call(this),this._.ajax=ajax,this._.transitions=transitions,this._.flashMessages=flashMessages,this._.request=null,this._.snippets={},this._.containerCache=null,this._.currentPhase=Snippet.INACTIVE,this._.transitioning=null,this._.setup=!1,this._.currentUrl=Url.fromCurrent(),this._.options=Arrays.mergeTree({},Service.defaults,options),DOM.addListener(document,"click",this._handleClick.bind(this)),DOM.addListener(document,"submit",this._handleSubmit.bind(this)),DOM.addListener(window,"popstate",this._handleState.bind(this)),this.on("error:default",this._showError.bind(this)),this._checkReady()},{STATIC:{defaults:{whitelistRedirects:!1,whitelistLinks:!0,whitelistForms:!0,defaultTransition:null}},setFormLocator:function(formLocator){return this._.formLocator=formLocator,this},open:function(url,method,data){return this._createRequest(url,method,data)},openLink:function(link,evt){return this._createRequest(link.href,"get",null,evt,link)},sendForm:function(form,evt){this._checkFormLocator(!0);var frm=this._.formLocator.getForm(form),data=frm.serialize();return this._createRequest(form.action,form.method,data,evt,form).then(function(){frm.reset()})},getSnippet:function(id){return this._.snippets[id]||(this._.snippets[id]=new Snippet(id,this._.currentPhase)),this._.snippets[id]},isSnippet:function(elem){return("string"==typeof elem?elem:elem.id)in this._.snippets},_checkFormLocator:function(need){if(this._.formLocator)return!0;if(!need)return!1;throw new Error("Nittro/Page service: Form support wasn't enabled. Please install Nittro/Application and inject the FormLocator service using the setFormLocator() method.")},_handleState:function(){var request,url=Url.fromCurrent();if(!(url.compare(this._.currentUrl)<=Url.PART.HASH)){this._.currentUrl=url,request=this._.ajax.createRequest(url);try{this._dispatchRequest(request)}catch(e){document.location.href=url.toAbsolute()}}},_pushState:function(payload,url){payload.postGet&&(url=payload.url),payload.title&&(document.title=payload.title),this._.currentUrl=Url.from(url),window.history.pushState(null,document.title,this._.currentUrl.toAbsolute())},_checkReady:function(){return"loading"===document.readyState?void DOM.addListener(document,"readystatechange",this._checkReady.bind(this)):void(this._.setup||(this._.setup=!0,window.setTimeout(function(){this._setup(),this._showHtmlFlashes(),this.trigger("update")}.bind(this),1)))},_checkLink:function(link){return this._.options.whitelistLinks?DOM.hasClass(link,"ajax"):!DOM.hasClass(link,"noajax")},_handleClick:function(evt){if(!(evt.defaultPrevented||evt.ctrlKey||evt.shiftKey||evt.altKey||evt.metaKey||this._checkFormLocator()&&this._handleButton(evt))){var url,link=DOM.closest(evt.target,"a");link&&this._checkLink(link)&&(url=Url.from(link.href),url.isLocal()&&url.compare()!==Url.PART.HASH&&this.openLink(link,evt))}},_checkForm:function(form){return this._.options.whitelistForms?DOM.hasClass(form,"ajax"):!DOM.hasClass(form,"noajax")},_handleButton:function(evt){var frm,btn=DOM.closest(evt.target,"button")||DOM.closest(evt.target,"input");return btn&&"submit"===btn.type?(btn.form&&this._checkForm(btn.form)&&(frm=this._.formLocator.getForm(btn.form),frm.setSubmittedBy(btn.name||null)),!0):void 0},_handleSubmit:function(evt){!evt.defaultPrevented&&this._checkFormLocator()&&evt.target instanceof HTMLFormElement&&this._checkForm(evt.target)&&this.sendForm(evt.target,evt)},_createRequest:function(url,method,data,evt,context){this._.request&&this._.request.abort();var request=this._.ajax.createRequest(url,method,data);try{var p=this._dispatchRequest(request,context,!0);return evt&&evt.preventDefault(),p}catch(e){return Promise.reject(e)}},_dispatchRequest:function(request,elem,pushState){this._.request=request;var transitionElms,removeElms,transition,xhr=this._.ajax.dispatch(request);elem?(transitionElms=this._getTransitionTargets(elem),removeElms=this._getRemoveTargets(elem),removeElms.length&&DOM.addClass(removeElms,"dynamic-remove"),this._.transitioning=transitionElms.concat(removeElms),transition=this._.transitions.transitionOut(this._.transitioning.slice())):(transitionElms=[],removeElms=[],transition=null);var p=Promise.all([xhr,transitionElms,removeElms,pushState||!1,transition]);return p.then(this._handleResponse.bind(this),this._handleError.bind(this))},_handleResponse:function(queue){if(!this._.request)return this._cleanup(),null;var response=queue[0],transitionElms=queue[1]||this._.transitioning||[],removeElms=queue[2],pushState=queue[3],payload=response.getPayload();if("object"!=typeof payload||!payload)return this._cleanup(),null;if(this._showFlashes(payload.flashes),this._tryRedirect(payload,pushState))return payload;pushState&&this._pushState(payload,this._.request.getUrl()),this._.request=this._.transitioning=null;var dynamic=this._applySnippets(payload.snippets||{},removeElms);return DOM.toggleClass(dynamic,"transition-middle",!0),this._showHtmlFlashes(),this.trigger("update",payload),this._.transitions.transitionIn(transitionElms.concat(dynamic)).then(function(){DOM.removeClass(dynamic,"dynamic-add dynamic-update")}),payload},_checkRedirect:function(payload){return!this._.options.whitelistRedirects!=!payload.allowAjax&&Url.from(payload.redirect).isLocal()},_tryRedirect:function(payload,pushState){return"redirect"in payload?(this._checkRedirect(payload)?this._dispatchRequest(this._.ajax.createRequest(payload.redirect),null,pushState):document.location.href=payload.redirect,!0):void 0},_cleanup:function(){this._.request=null,this._.transitioning&&(this._.transitions.transitionIn(this._.transitioning),this._.transitioning=null)},_showFlashes:function(flashes){if(flashes){var id,i;for(id in flashes)if(flashes.hasOwnProperty(id)&&flashes[id])for(i=0;i<flashes[id].length;i++)this._.flashMessages.add(null,flashes[id][i].type,flashes[id][i].message)}},_showHtmlFlashes:function(){var i,n,data,elms=DOM.getByClassName("flashes-src");for(i=0,n=elms.length;n>i;i++)data=JSON.parse(elms[i].textContent.trim()),elms[i].parentNode.removeChild(elms[i]),this._showFlashes(data)},_handleError:function(evt){this._cleanup(),this.trigger("error",evt)},_showError:function(evt){this._.flashMessages.add(null,"error","There was an error processing your request. Please try again later.")}});_context.mixin(Service,SnippetHelpers),_context.register(Service,"Service")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays",Url:"Utils.Url"}),_context.invoke("Nittro.Widgets",function(DOM,Arrays){var FlashMessages=_context.extend(function(options){this._={options:Arrays.mergeTree({},FlashMessages.defaults,options),globalHolder:DOM.create("div",{"class":"flash-global-holder"})},this._.options.layer.appendChild(this._.globalHolder),this._.options.positioning||(this._.options.positioning=FlashMessages.basicPositioning)},{STATIC:{defaults:{layer:null,minMargin:20,positioning:null},basicPositioning:[function(target,elem,minMargin){var res={name:"below",left:target.left+(target.width-elem.width)/2,top:target.bottom};return target.bottom+elem.height+minMargin<window.innerHeight&&res.left>0&&res.left+elem.width<window.innerWidth?res:void 0},function(target,elem,minMargin){var res={name:"rightOf",left:target.right,top:target.top+(target.height-elem.height)/2};return target.right+elem.width+minMargin<window.innerWidth&&res.top>0&&res.top+elem.height<window.innerHeight?res:void 0},function(target,elem,minMargin){var res={name:"above",left:target.left+(target.width-elem.width)/2,top:target.top-elem.height};return target.top>elem.height+minMargin&&res.left>0&&res.left+elem.width<window.innerWidth?res:void 0},function(target,elem,minMargin){var res={name:"leftOf",left:target.left-elem.width,top:target.top+(target.height-elem.height)/2};return target.left>elem.width+minMargin&&res.top>0&&res.top+elem.height<window.innerHeight?res:void 0}]},add:function(target,type,content,rich){var elem=DOM.create("div",{"class":"flash flash-"+(type||"info")});target&&"string"==typeof target&&(target=DOM.getById(target)),rich?DOM.html(elem,content):elem.textContent=content,DOM.setStyle(elem,"opacity",0),this._.options.layer.appendChild(elem);var style={},timeout=Math.max(2e3,Math.round(elem.textContent.split(/\s+/).length/.003));if(target){var position,fixed=this._hasFixedParent(target),elemRect=this._getRect(elem),targetRect=this._getRect(target);fixed&&(style.position="fixed");for(var i=0;i<this._.options.positioning.length&&!(position=this._.options.positioning[i].call(null,targetRect,elemRect,this._.options.minMargin));i++);if(position)return style.left=position.left,style.top=position.top,fixed||(style.left+=window.pageXOffset,style.top+=window.pageYOffset),style.left+="px",style.top+="px",style.opacity="",DOM.setStyle(elem,style),void this._show(elem,position.name,timeout)}this._.globalHolder.appendChild(elem),DOM.setStyle(elem,"opacity",""),this._show(elem,"global",timeout)},_show:function(elem,position,timeout){DOM.addClass(elem,"flash-show flash-"+position),window.setTimeout(function(){window.pageYOffset;DOM.removeClass(elem,"flash-show"),this._bindHide(elem,timeout)}.bind(this),1)},_bindHide:function(elem,timeout){var hide=function(){DOM.removeListener(document,"mousemove",hide),DOM.removeListener(document,"mousedown",hide),DOM.removeListener(document,"keydown",hide),DOM.removeListener(document,"touchstart",hide),window.setTimeout(function(){DOM.addClass(elem,"flash-hide"),window.setTimeout(function(){elem.parentNode.removeChild(elem)},1e3)},timeout)}.bind(this);DOM.addListener(document,"mousemove",hide),DOM.addListener(document,"mousedown",hide),DOM.addListener(document,"keydown",hide),DOM.addListener(document,"touchstart",hide)},_hasFixedParent:function(elem){do{if("fixed"===elem.style.position)return!0;elem=elem.offsetParent}while(elem&&elem!==document.documentElement&&elem!==document.body);return!1},_getRect:function(elem){var rect=elem.getBoundingClientRect();return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:"width"in rect?rect.width:rect.right-rect.left,height:"height"in rect?rect.height:rect.bottom-rect.top}}});_context.register(FlashMessages,"FlashMessages")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays"});