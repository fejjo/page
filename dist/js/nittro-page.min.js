_context.invoke("Nittro.Ajax",function(undefined){var FormData=_context.extend(function(){this._dataStorage=[],this._upload=!1},{append:function(name,value){if(value===undefined||null===value)return this;if(this._isFile(value))this._upload=!0;else{if("object"==typeof value&&"valueOf"in value&&/string|number|boolean/.test(typeof value.valueOf())&&!arguments[2])return this.append(name,value.valueOf(),!0);if(!/string|number|boolean/.test(typeof value))throw new Error("Only scalar values and File/Blob objects can be appended to FormData, "+typeof value+" given")}return this._dataStorage.push({name:name,value:value}),this},isUpload:function(){return this._upload},_isFile:function(value){return window.File!==undefined&&value instanceof window.File||window.Blob!==undefined&&value instanceof window.Blob},mergeData:function(data){for(var i=0;i<data.length;i++)this.append(data[i].name,data[i].value);return this},exportData:function(forcePlain){if(!forcePlain&&this.isUpload()&&window.FormData!==undefined){var i,fd=new window.FormData;for(i=0;i<this._dataStorage.length;i++)fd.append(this._dataStorage[i].name,this._dataStorage[i].value);return fd}return this._dataStorage.filter(function(e){return!this._isFile(e.value)},this)}});_context.register(FormData,"FormData")}),_context.invoke("Nittro.Ajax",function(Url,FormData,undefined){var Request=_context.extend("Nittro.Object",function(url,method,data){this._={url:Url.from(url),method:(method||"GET").toUpperCase(),data:data||{},headers:{},normalized:!1,aborted:!1}},{getUrl:function(){return this._normalize(),this._.url},getMethod:function(){return this._.method},isGet:function(){return"GET"===this._.method},isPost:function(){return"POST"===this._.method},isMethod:function(method){return method.toUpperCase()===this._.method},getData:function(){return this._normalize(),this._.data},getHeaders:function(){return this._.headers},setUrl:function(url){return this._updating("url"),this._.url=Url.from(url),this},setMethod:function(method){return this._updating("method"),this._.method=method.toLowerCase(),this},setData:function(k,v){if(this._updating("data"),null===k)this._.data={};else if(v===undefined&&"object"==typeof k)for(v in k)k.hasOwnProperty(v)&&(this._.data[v]=k[v]);else this._.data[k]=v;return this},setHeader:function(header,value){return this._updating("headers"),this._.headers[header]=value,this},setHeaders:function(headers){this._updating("headers");for(var header in headers)headers.hasOwnProperty(header)&&(this._.headers[header]=headers[header]);return this},abort:function(){return this._.aborted||(this._.aborted=!0,this.trigger("abort")),this},isAborted:function(){return this._.aborted},_normalize:function(){!this._.normalized&&this.isFrozen()&&(this._.normalized=!0,("GET"===this._.method||"HEAD"===this._.method)&&(this._.url.addParams(this._.data instanceof FormData?this._.data.exportData(!0):this._.data),this._.data={}))}});_context.mixin(Request,"Nittro.Freezable"),_context.register(Request,"Request")},{Url:"Utils.Url"}),_context.invoke("Nittro.Ajax",function(){var Response=_context.extend(function(status,payload,headers){this._={status:status,payload:payload,headers:headers}},{getStatus:function(){return this._.status},getPayload:function(){return this._.payload},getHeader:function(name){return this._.headers[name.toLowerCase()]},getAllHeaders:function(){return this._.headers}});_context.register(Response,"Response")}),_context.invoke("Nittro.Ajax",function(Request){var Service=_context.extend("Nittro.Object",function(){Service.Super.call(this),this._.transports=[]},{addTransport:function(transport){return this._.transports.push(transport),this},get:function(url,data){return this.dispatch(this.createRequest(url,"get",data))},post:function(url,data){return this.dispatch(this.createRequest(url,"post",data))},createRequest:function(url,method,data){var request=new Request(url,method,data);return this.trigger("request-created",{request:request}),request},dispatch:function(request){request.freeze();for(var i=0;i<this._.transports.length;i++)try{return this._.transports[i].dispatch(request)}catch(e){console.log(e)}throw new Error("No transport is able to dispatch this request")}});_context.register(Service,"Service")}),_context.invoke("Nittro.Ajax.Transport",function(Response,FormData,Url){var Native=_context.extend(function(){},{STATIC:{createXhr:function(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return new ActiveXObject("Microsoft.XMLHTTP")}}},dispatch:function(request){var xhr=Native.createXhr(),adv=this.checkSupport(xhr),self=this,abort=function(){xhr.abort()},cleanup=function(){request.off("abort",abort)};return request.on("abort",abort),new Promise(function(fulfill,reject){request.isAborted()&&(cleanup(),reject(self._createError(xhr,{type:"abort"}))),self._bindEvents(request,xhr,adv,cleanup,fulfill,reject),xhr.open(request.getMethod(),request.getUrl().toAbsolute(),!0);var data=self._formatData(request,xhr);self._addHeaders(request,xhr),xhr.send(data)})},checkSupport:function(xhr){var adv;if(!((adv="addEventListener"in xhr)||"onreadystatechange"in xhr))throw new Error("Unsupported XHR implementation");return adv},_bindEvents:function(request,xhr,adv,cleanup,fulfill,reject){var self=this,onLoad=function(evt){if(cleanup(),200===xhr.status){var response=self._createResponse(xhr);request.trigger("success",response),fulfill(response)}else{var err=self._createError(xhr,evt);request.trigger("error",err),reject(err)}},onError=function(evt){cleanup();var err=self._createError(xhr,evt);request.trigger("error",err),reject(err)},onProgress=function(evt){request.trigger("progress",{lengthComputable:evt.lengthComputable,loaded:evt.loaded,total:evt.total})};adv?(xhr.addEventListener("load",onLoad,!1),xhr.addEventListener("error",onError,!1),xhr.addEventListener("abort",onError,!1),"upload"in xhr&&xhr.upload.addEventListener("progress",onProgress,!1)):(xhr.onreadystatechange=function(){4===xhr.readyState&&(200===xhr.status?onLoad():onError())},"ontimeout"in xhr&&(xhr.ontimeout=onError),"onerror"in xhr&&(xhr.onerror=onError),"onload"in xhr&&(xhr.onload=onLoad))},_addHeaders:function(request,xhr){var h,headers=request.getHeaders();for(h in headers)headers.hasOwnProperty(h)&&xhr.setRequestHeader(h,headers[h]);headers.hasOwnProperty("X-Requested-With")||xhr.setRequestHeader("X-Requested-With","XMLHttpRequest")},_formatData:function(request,xhr){var data=request.getData();return data instanceof FormData?(data=data.exportData(request.isGet()||request.isMethod("HEAD")),data instanceof window.FormData||(data=Url.buildQuery(data,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"))):(data=Url.buildQuery(data),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),data},_createResponse:function(xhr){var payload,headers={};return(xhr.getAllResponseHeaders()||"").trim().split(/\r\n/g).forEach(function(header){header&&!header.match(/^\s+$/)&&(header=header.match(/^\s*([^:]+):\s*(.+)\s*$/),headers[header[1].toLowerCase()]=header[2])}),payload="application/json"===headers["content-type"]?JSON.parse(xhr.responseText||"{}"):xhr.responseText,new Response(xhr.status,payload,headers)},_createError:function(xhr,evt){var response=null;return 4===xhr.readyState&&0!==xhr.status&&(response=this._createResponse(xhr)),evt&&"abort"===evt.type?{type:"abort",status:null,response:response}:0===xhr.status?{type:"connection",status:null,response:response}:200!==xhr.status?{type:"response",status:xhr.status,response:response}:{type:"unknown",status:xhr.status,response:response}}});_context.register(Native,"Native")},{Url:"Utils.Url",Response:"Nittro.Ajax.Response",FormData:"Nittro.Ajax.FormData"}),_context.invoke("Nittro.Page",function(DOM){var Snippet=_context.extend(function(id,state){this._={id:id,state:"number"==typeof state?state:Snippet.INACTIVE,handlers:[[],[],[],[]]}},{STATIC:{INACTIVE:-1,PREPARE_SETUP:0,RUN_SETUP:1,PREPARE_TEARDOWN:2,RUN_TEARDOWN:3},setup:function(prepare,run){return prepare&&!run&&(run=prepare,prepare=null),prepare&&(this._.state===Snippet.PREPARE_SETUP?prepare(this.getElement()):this._.handlers[Snippet.PREPARE_SETUP].push(prepare)),run&&(this._.state===Snippet.RUN_SETUP?run(this.getElement()):this._.handlers[Snippet.RUN_SETUP].push(run)),this},teardown:function(prepare,run){return prepare&&!run&&(run=prepare,prepare=null),prepare&&(this._.state===Snippet.PREPARE_TEARDOWN?prepare(this.getElement()):this._.handlers[Snippet.PREPARE_TEARDOWN].push(prepare)),run&&(this._.state===Snippet.RUN_TEARDOWN?run(this.getElement()):this._.handlers[Snippet.RUN_TEARDOWN].push(run)),this},setState:function(state){if(state===Snippet.INACTIVE)this._.state=state,this._.handlers.forEach(function(queue){queue.splice(0,queue.length)});else if((this._.state+1)%4===state){this._.state=state;var elm=this.getElement();this._.handlers[this._.state].forEach(function(handler){handler(elm)}),this._.handlers[this._.state].splice(0,this._.handlers[this._.state].length)}return this},getState:function(){return this._.state},getElement:function(){return DOM.getById(this._.id)}});_context.register(Snippet,"Snippet")},{DOM:"Utils.DOM"}),_context.invoke("Nittro.Page",function(Snippet,DOM){var SnippetManager=_context.extend(function(reportPhase){this._={snippets:{},currentPhase:Snippet.INACTIVE,formLocator:null,reportPhase:reportPhase}},{setFormLocator:function(formLocator){return this._.formLocator=formLocator,this},getSnippet:function(id){return this._.snippets[id]||(this._.snippets[id]=new Snippet(id,this._.currentPhase)),this._.snippets[id]},isSnippet:function(elem){return("string"==typeof elem?elem:elem.id)in this._.snippets},applySnippets:function(snippets,removeTarget){var setup={},teardown={},dynamic=[];return removeTarget&&(this._cleanupChildSnippets(removeTarget,teardown),this._cleanupForms(removeTarget),this.isSnippet(removeTarget)&&(teardown[removeTarget.id]=!0)),this._prepareSnippets(snippets,setup,teardown,dynamic),this._teardown(teardown),removeTarget&&(removeTarget.parentNode.removeChild(removeTarget),removeTarget=null),this._setupDynamic(dynamic,snippets),this._setup(setup,snippets),dynamic},setup:function(){return this._setup(),this},_cleanupChildSnippets:function(elem,teardown){for(var i in this._.snippets)this._.snippets.hasOwnProperty(i)&&this._.snippets[i].getState()===Snippet.RUN_SETUP&&this._.snippets[i].getElement()!==elem&&DOM.contains(elem,this._.snippets[i].getElement())&&(teardown[i]=!0)},_cleanupForms:function(snippet){if(this._.formLocator)if("form"===snippet.tagName.toLowerCase())this._.formLocator.removeForm(snippet);else{var i,forms=snippet.getElementsByTagName("form");for(i=0;i<forms.length;i++)this._.formLocator.removeForm(forms.item(i))}},_prepareSnippets:function(snippets,setup,teardown,dynamic){for(var id in snippets)snippets.hasOwnProperty(id)&&this._prepareSnippet(id,setup,teardown,dynamic)},_prepareSnippet:function(id,setup,teardown,dynamic){this._.snippets[id]&&this._.snippets[id].getState()===Snippet.RUN_SETUP&&(teardown[id]=!1);var snippet=DOM.getById(id);snippet?(this._cleanupChildSnippets(snippet,teardown),this._cleanupForms(snippet),setup[id]=!0,this._isDynamic(snippet,id)&&dynamic.push([id,snippet,!1])):dynamic.push([id,null,!1])},_teardown:function(snippets){this._setSnippetsState(snippets,Snippet.PREPARE_TEARDOWN),this._setSnippetsState(snippets,Snippet.RUN_TEARDOWN),this._setSnippetsState(snippets,Snippet.INACTIVE),this._.reportPhase("teardown");for(var id in snippets)snippets.hasOwnProperty(id)&&snippets[id]&&delete this._.snippets[id]},_setupDynamic:function(snippets,data){snippets.forEach(function(snippet){null===snippet[1]&&(snippet[1]=this._insertDynamic(snippet[0],data[snippet[0]]),snippet[2]=!0)}.bind(this))},_setup:function(snippets,data){if(data)for(var id in snippets)snippets.hasOwnProperty(id)&&DOM.html(id,data[id]||"");this._.reportPhase("setup"),this._setSnippetsState(this._.snippets,Snippet.PREPARE_SETUP),this._setSnippetsState(this._.snippets,Snippet.RUN_SETUP)},_setSnippetsState:function(snippets,state){this._.currentPhase=state;for(var id in snippets)snippets.hasOwnProperty(id)&&this.getSnippet(id).setState(state)},_isDynamic:function(elem,id){return elem.parentNode&&DOM.hasClass(elem.parentNode,"snippet-container")?!!id.match(new RegExp("^"+DOM.getData(elem.parentNode,"dynamicMask")+"$")):!1},_insertDynamic:function(id,data){var container=null;if(DOM.getByClassName("snippet-container").some(function(elem){var pattern=new RegExp("^"+DOM.getData(elem,"dynamicMask")+"$");return pattern.test(id)?(container=elem,!0):void 0}),!container)throw new Error("No container found for dynamic snippet ID #"+id);var elem=(DOM.getData(container,"dynamicElement")||"div").split(/\./g),insertMode=DOM.getData(container,"dynamicInsertMode")||"append";switch(elem[0]=DOM.create(elem[0],{id:id}),elem.length>1&&DOM.addClass.apply(null,elem),elem=elem[0],DOM.html(elem,data),insertMode){case"append":container.appendChild(elem);break;case"prepend":container.hasChildNodes()?container.insertBefore(elem,container.firstChild):container.appendChild(elem);break;default:if(!insertMode.match(/^sorted:/i))throw new TypeError("Invalid insert mode for dynamic snippet container "+container.getAttribute("id"));this._insertSortedSnippet(container,elem,insertMode.substr(7))}return elem},_insertSortedSnippet:function(container,snippet,descriptor){var x,d,s,a,o,e,val,i,f,search=[],children=DOM.getChildren(container),c=0,n=children.length;if(!n)return void container.appendChild(snippet);for(val=function(e,s,a,d){var n=e.getElementsByClassName(s);return n.length?a?n[0].getAttribute(a):d?DOM.getData(n[0],d):n[0].textContent:null},descriptor=descriptor.trim().split(/\s*;\s*/);descriptor.length;)if(x=descriptor.shift(),s=x.match(/^(.+?)(?:\[(.+?)\])?(?:<(.+?)>)?(?:\s+(.+?))?$/i)){if(o=s[4]||null,d=s[3]||null,a=s[2]||null,s=s[1],s.match(/^[^.]|[\s#\[>+:]/))throw new TypeError("Invalid selector for sorted insert mode in container #"+container.getAttribute("id"));search.push({sel:s.substr(1),attr:a,data:d,asc:o?o.match(/^[1tay]/i):!0,value:val(snippet,s.substr(1),a,d)})}for(s=0;s<search.length;s++){for(x=search[s],f=!1,i=c;n>i;i++)if(e=children[i],d=val(e,x.sel,x.attr,x.data),x.asc)if(x.value>d)c=i;else{if(x.value<d){n=i;break}f||(c=i,f=!0)}else if(x.value<d)c=i;else{if(x.value>d){n=i;break}f||(c=i,f=!0)}if(n===c)return void container.insertBefore(snippet,children[n]);if(n===c+1&&!f)return void(c>=children.length-1?container.appendChild(snippet):container.insertBefore(snippet,children[c+1]))}x.asc?n>=children.length?container.appendChild(snippet):container.insertBefore(snippet,children[n]):container.insertBefore(snippet,children[c])}});_context.register(SnippetManager,"SnippetManager")},{DOM:"Utils.DOM"}),_context.invoke("Nittro.Page",function(DOM){var Transitions=_context.extend(function(duration){this._={duration:duration||!1,ready:!0,queue:[],support:!1,property:null};try{var s=DOM.create("span").style;this._.support=["transition","WebkitTransition","MozTransition","msTransition","OTransition"].some(function(prop){return prop in s?(this._.property=prop,!0):void 0}.bind(this)),s=null}catch(e){}},{transitionOut:function(elements){return this._begin(elements,"transition-out")},transitionIn:function(elements){return this._begin(elements,"transition-in")},_begin:function(elements,className){return this._.support&&this._.duration&&elements.length?this._resolve(elements,className):Promise.resolve(elements)},_resolve:function(elements,className){if(!this._.ready)return new Promise(function(resolve){this._.queue.push([elements,className,resolve])}.bind(this));if(this._.ready=!1,"transition-in"===className){window.pageXOffset}DOM.addClass(elements,"transition-active "+className),DOM.removeClass(elements,"transition-middle");var duration=this._getDuration(elements),promise=new Promise(function(resolve){window.setTimeout(function(){DOM.removeClass(elements,"transition-active "+className),"transition-out"===className&&DOM.addClass(elements,"transition-middle"),this._.ready=!0,resolve(elements)}.bind(this),duration)}.bind(this));return promise.then(function(){if(this._.queue.length){var q=this._.queue.shift();this._resolve(q[0],q[1]).then(function(){q[2](q[0])})}}.bind(this)),promise},_getDuration:function(elements){if(!window.getComputedStyle)return this._.duration;var durations=[],prop=this._.property+"Duration";return elements.forEach(function(elem){var duration=window.getComputedStyle(elem)[prop];duration&&(duration=(duration+"").trim().split(/\s*,\s*/g).map(function(v){return v=v.match(/^((?:\d*\.)?\d+)(m?s)$/),v?parseFloat(v[1])*("ms"===v[2]?1:1e3):0}),durations.push.apply(durations,duration.filter(function(v){return v>0})))}),durations.length?Math.max.apply(null,durations):this._.duration}});_context.register(Transitions,"Transitions")},{DOM:"Utils.DOM"}),_context.invoke("Nittro.Page",function(DOM,Arrays,Url,SnippetManager,Snippet){var Service=_context.extend("Nittro.Object",function(ajax,transitions,flashMessages,options){Service.Super.call(this),this._.ajax=ajax,this._.transitions=transitions,this._.flashMessages=flashMessages,this._.snippetManager=new SnippetManager(this._handlePhase.bind(this)),this._.request=null,this._.transitioning=null,this._.setup=!1,this._.currentUrl=Url.fromCurrent(),this._.options=Arrays.mergeTree({},Service.defaults,options),DOM.addListener(document,"click",this._handleClick.bind(this)),DOM.addListener(document,"submit",this._handleSubmit.bind(this)),DOM.addListener(window,"popstate",this._handleState.bind(this)),this.on("error:default",this._showError.bind(this)),this._checkReady()},{STATIC:{defaults:{whitelistRedirects:!1,whitelistLinks:!0,whitelistForms:!0,defaultTransition:null}},setFormLocator:function(formLocator){return this._.formLocator=formLocator,this._.snippetManager.setFormLocator(formLocator),this},open:function(url,method,data){return this._createRequest(url,method,data)},openLink:function(link,evt){return this._createRequest(link.href,"get",null,evt,link)},sendForm:function(form,evt){this._checkFormLocator(!0);var frm=this._.formLocator.getForm(form),data=frm.serialize();return this._createRequest(form.action,form.method,data,evt,form).then(function(){frm.reset()})},getSnippet:function(id){return this._.snippetManager.getSnippet(id)},isSnippet:function(elem){return this._.snippetManager.isSnippet(elem)},_handlePhase:function(phase){this.trigger(phase)},_checkFormLocator:function(need){if(this._.formLocator)return!0;if(!need)return!1;throw new Error("Nittro/Page service: Form support wasn't enabled. Please install Nittro/Application and inject the FormLocator service using the setFormLocator() method.")},_handleState:function(){var request,url=Url.fromCurrent();if(!(url.compare(this._.currentUrl)<=Url.PART.HASH)){this._.currentUrl=url,request=this._.ajax.createRequest(url);try{this._dispatchRequest(request)}catch(e){document.location.href=url.toAbsolute()}}},_pushState:function(payload,url){payload.postGet&&(url=payload.url),this._.currentUrl=Url.from(url),window.history.pushState(null,payload.title||document.title,this._.currentUrl.toAbsolute())},_checkReady:function(){return"loading"===document.readyState?void DOM.addListener(document,"readystatechange",this._checkReady.bind(this)):void(this._.setup||(this._.setup=!0,window.setTimeout(function(){this._.snippetManager.setup(),this._showHtmlFlashes(),this.trigger("update")}.bind(this),1)))},_checkLink:function(link){return this._.options.whitelistLinks?DOM.hasClass(link,"ajax"):!DOM.hasClass(link,"noajax")},_handleClick:function(evt){if(!(evt.defaultPrevented||evt.ctrlKey||evt.shiftKey||evt.altKey||evt.metaKey||this._checkFormLocator()&&this._handleButton(evt))){var url,link=DOM.closest(evt.target,"a");link&&this._checkLink(link)&&(url=Url.from(link.href),url.isLocal()&&url.compare()!==Url.PART.HASH&&this.openLink(link,evt))}},_checkForm:function(form){return this._.options.whitelistForms?DOM.hasClass(form,"ajax"):!DOM.hasClass(form,"noajax")},_handleButton:function(evt){var frm,btn=DOM.closest(evt.target,"button")||DOM.closest(evt.target,"input");return btn&&"submit"===btn.type?(btn.form&&this._checkForm(btn.form)&&(frm=this._.formLocator.getForm(btn.form),frm.setSubmittedBy(btn.name||null)),!0):void 0},_handleSubmit:function(evt){!evt.defaultPrevented&&this._checkFormLocator()&&evt.target instanceof HTMLFormElement&&this._checkForm(evt.target)&&this.sendForm(evt.target,evt)},_createRequest:function(url,method,data,evt,context){this._.request&&this._.request.abort();var request=this._.ajax.createRequest(url,method,data);try{var p=this._dispatchRequest(request,context,!0);return evt&&evt.preventDefault(),p}catch(e){return Promise.reject(e)}},_dispatchRequest:function(request,elem,pushState){this._.request=request;var transitionTargets,xhr=this._.ajax.dispatch(request),removeTarget=null,transition=null;elem&&(transitionTargets=this._getTransitionTargets(elem),removeTarget=this._getRemoveTarget(elem),removeTarget&&(DOM.addClass(removeTarget,"dynamic-remove"),transitionTargets.push(removeTarget)),transition=this._.transitions.transitionOut(transitionTargets),this._.transitioning=transitionTargets);var p=Promise.all([xhr,transition,removeTarget,pushState||!1]);return p.then(this._handleResponse.bind(this),this._handleError.bind(this)),p},_handleResponse:function(queue){if(!this._.request)return void this._cleanup();var response=queue[0],transitionTargets=queue[1]||this._.transitioning||[],removeTarget=queue[2],pushState=queue[3],payload=response.getPayload();if("object"!=typeof payload||!payload)return void this._cleanup();if(this._showFlashes(payload.flashes),!this._tryRedirect(payload)){pushState&&this._pushState(payload||{},this._.request.getUrl()),this._.request=this._.transitioning=null,removeTarget&&transitionTargets.pop();var dynamic=this._.snippetManager.applySnippets(payload.snippets||{},removeTarget);return this._transitionDynamic(dynamic,transitionTargets),this._showHtmlFlashes(),this.trigger("update",payload),this._.transitions.transitionIn(transitionTargets).then(function(){this._cleanupDynamic(dynamic)}.bind(this)),payload}},_checkRedirect:function(payload){return!this._.options.whitelistRedirects!=!payload.allowAjax&&Url.from(payload.redirect).isLocal()},_tryRedirect:function(payload){return"redirect"in payload?(this._checkRedirect(payload)?this._dispatchRequest(this._.ajax.createRequest(payload.redirect),null,pushState):document.location.href=payload.redirect,!0):void 0},_cleanup:function(){this._.request=null,this._.transitioning&&(this._.transitions.transitionIn(this._.transitioning),this._.transitioning=null)},_transitionDynamic:function(snippets,transitionTargets){snippets.forEach(function(snippet){DOM.addClass(snippet[1],snippet[2]?"dynamic-add":"dynamic-update"),transitionTargets.push(snippet[1])})},_cleanupDynamic:function(snippets){snippets.forEach(function(snippet){DOM.removeClass(snippet[1],snippet[2]?"dynamic-add":"dynamic-update")})},_showFlashes:function(flashes){if(flashes){var id,i;for(id in flashes)if(flashes.hasOwnProperty(id)&&flashes[id])for(i=0;i<flashes[id].length;i++)this._.flashMessages.add(null,flashes[id][i].type,flashes[id][i].message)}},_showHtmlFlashes:function(){var i,n,data,elms=DOM.getByClassName("flashes-src");for(i=0,n=elms.length;n>i;i++)data=JSON.parse(elms[i].textContent.trim()),elms[i].parentNode.removeChild(elms[i]),this._showFlashes(data)},_handleError:function(err){this._cleanup(),this.trigger("error",err)},_showError:function(evt){this._.flashMessages.add(null,"error","There was an error processing your request. Please try again later.")},_getTransitionTargets:function(elem){var sel=DOM.getData(elem,"transition")||this._.options.defaultTransition,elms=[];return sel?("string"==typeof sel&&(sel=sel.trim().split(/\s*,\s*/g)),sel.forEach(function(sel){if(sel.match(/^[^.#]|[\s\[>+:]/))throw new TypeError("Invalid transition selector, only single-level .class and #id are allowed");if("#"===sel.charAt(0))sel=DOM.getById(sel.substr(1)),sel&&elms.push(sel);else{var matching=DOM.getByClassName(sel.substr(1));elms.push.apply(elms,matching)}}),elms):elms},_getRemoveTarget:function(elem){var id=DOM.getData(elem,"dynamicRemove");return id?DOM.getById(id):null}});_context.register(Service,"Service")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays",Url:"Utils.Url"}),_context.invoke("Nittro.Widgets",function(DOM,Arrays){var FlashMessages=_context.extend(function(options){this._={options:Arrays.mergeTree({},FlashMessages.defaults,options),globalHolder:DOM.create("div",{"class":"flash-global-holder"})},this._.options.layer.appendChild(this._.globalHolder),this._.options.positioning||(this._.options.positioning=FlashMessages.basicPositioning)},{STATIC:{defaults:{layer:null,minMargin:20,positioning:null},basicPositioning:[function(target,elem,minMargin){var res={name:"below",left:target.left+(target.width-elem.width)/2,top:target.bottom};return target.bottom+elem.height+minMargin<window.innerHeight&&res.left>0&&res.left+elem.width<window.innerWidth?res:void 0},function(target,elem,minMargin){var res={name:"rightOf",left:target.right,top:target.top+(target.height-elem.height)/2};return target.right+elem.width+minMargin<window.innerWidth&&res.top>0&&res.top+elem.height<window.innerHeight?res:void 0},function(target,elem,minMargin){var res={name:"above",left:target.left+(target.width-elem.width)/2,top:target.top-elem.height};return target.top>elem.height+minMargin&&res.left>0&&res.left+elem.width<window.innerWidth?res:void 0},function(target,elem,minMargin){var res={name:"leftOf",left:target.left-elem.width,top:target.top+(target.height-elem.height)/2};return target.left>elem.width+minMargin&&res.top>0&&res.top+elem.height<window.innerHeight?res:void 0}]},add:function(target,type,content,rich){var elem=DOM.create("div",{"class":"flash flash-"+(type||"info")});target&&"string"==typeof target&&(target=DOM.getById(target)),rich?DOM.html(elem,content):elem.textContent=content,DOM.setStyle(elem,"opacity",0),this._.options.layer.appendChild(elem);var style={},timeout=Math.max(2e3,Math.round(elem.textContent.split(/\s+/).length/.003));if(target){var position,fixed=this._hasFixedParent(target),elemRect=this._getRect(elem),targetRect=this._getRect(target);fixed&&(style.position="fixed");for(var i=0;i<this._.options.positioning.length&&!(position=this._.options.positioning[i].call(null,targetRect,elemRect,this._.options.minMargin));i++);if(position)return style.left=position.left,style.top=position.top,fixed||(style.left+=window.pageXOffset,style.top+=window.pageYOffset),style.left+="px",style.top+="px",style.opacity="",DOM.setStyle(elem,style),void this._show(elem,position.name,timeout)}this._.globalHolder.appendChild(elem),DOM.setStyle(elem,"opacity",""),this._show(elem,"global",timeout)},_show:function(elem,position,timeout){DOM.addClass(elem,"flash-show flash-"+position),window.setTimeout(function(){window.pageYOffset;DOM.removeClass(elem,"flash-show"),this._bindHide(elem,timeout)}.bind(this),1)},_bindHide:function(elem,timeout){var hide=function(){DOM.removeListener(document,"mousemove",hide),DOM.removeListener(document,"mousedown",hide),DOM.removeListener(document,"keydown",hide),DOM.removeListener(document,"touchstart",hide),window.setTimeout(function(){DOM.addClass(elem,"flash-hide"),window.setTimeout(function(){elem.parentNode.removeChild(elem)},1e3)},timeout)}.bind(this);DOM.addListener(document,"mousemove",hide),DOM.addListener(document,"mousedown",hide),DOM.addListener(document,"keydown",hide),DOM.addListener(document,"touchstart",hide)},_hasFixedParent:function(elem){do{if("fixed"===elem.style.position)return!0;elem=elem.offsetParent}while(elem&&elem!==document.documentElement&&elem!==document.body);return!1},_getRect:function(elem){var rect=elem.getBoundingClientRect();return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:"width"in rect?rect.width:rect.right-rect.left,height:"height"in rect?rect.height:rect.bottom-rect.top}}});_context.register(FlashMessages,"FlashMessages")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays"});